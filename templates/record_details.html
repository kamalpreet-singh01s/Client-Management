{% extends 'index.html' %}

{% block content %}
{% include 'alert.html' %}

<style>


label{
    font-weight:bold;
}

.bold{
font-weight:bold;
}


input[type="file"] {
    display: none;
}
.custom-file-upload {
    border: 1px solid #ccc;
    display: inline-block;
    padding: 3px 12px;
    cursor: pointer;
    background-color: #0dcaf070;
}






body{
    background-color: #f8f9fa;
}


</style>

<form action="{{request.path}}" method="post" enctype="multipart/form-data" style="overflow:hidden">
    <div class="row mx-auto mt-2" id="action_buttons" style="z-index:1; width:75%">

        <!--        <div class="row mb-2">-->
        {% if record_to_update.status.value == RecordStatus.received.value or record_to_update.status.value ==
        RecordStatus.cancelled.value%}
        <div class="col-2">
            <button style="display:none; padding:0.3rem 2.5rem" type="button"
                    class="btn btn-success btn-sm edit_button mt-2"
                    onclick="hideDisable()"
                    id="edit_button">
                Edit
            </button>
        </div>
        <div class="col-8 text-center" id="voucher_book">
            <img src="{{url_for('static', filename= 'book.png')}}" alt="no image" height="40px"
                 style="cursor:pointer"
                 onclick="location.href='{{url_for('voucher_list', record_id = record_to_update.id)}}'">
            <h6>{{total_vouchers}}</h6>
        </div>
        {%else%}
        <div class="col-2">
            <button style="display:block;padding:0.3rem 2.5rem" type="button"
                    class="btn btn-success btn-sm edit_button mt-2"
                    onclick="hideDisable()"
                    id="edit_button">
                Edit
            </button>
        </div>

        <div title="Payment Vouchers" class="col-8 text-center" id="voucher_book">
            <img src="{{url_for('static', filename= 'book.png')}}" alt="no image" height="40px"
                 style="cursor:pointer"
                 onclick="location.href='{{url_for('voucher_list', record_id = record_to_update.id)}}'">
            <h6>{{total_vouchers}}</h6>
        </div>
        <div class="col-2 text-end mt-2">
            <button type="button" class="btn btn-danger btn-sm"
                    id="cancelled_button_before" style="padding:0.3rem 1.5rem"
                    onclick="location.href='{{url_for('set_cancel',record_id = record_to_update.id)}}'">
                Cancel
            </button>
        </div>
        {%endif%}


        <div class="row">
            <div class="col-3" style="display:none" id="update_discard_button_for_bill_details">
                <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups" id="btn-toolbar">
                    <div class="btn-group me-2" role="group" aria-label="First group">
                        <input type="submit" value="Update" style="padding:0.3rem 1.5rem"
                               class="update_btn btn btn-success btn-sm"
                               onclick="location.href='{{url_for('record_details',record_id = record_to_update.id)}}'"
                        />

                    </div>
                    <div class="btn-group me-2" role="group" aria-label="Second group">
                        <button type="button" class="btn btn-danger btn-sm" style="padding:0.3rem 1.5rem"
                                onclick="location.href='{{url_for('record_details',record_id = record_to_update.id)}}'"
                        >
                            Discard
                        </button>
                    </div>
                </div>
            </div>
            <div title="Payment Vouchers" class="col-4 text-center" id="voucher_book_action_button" hidden>
                <img src="{{url_for('static', filename= 'book.png')}}" alt="no image" height="40px"
                     style="cursor:pointer;margin-left:162px" id="voucher_book_action_button_image"
                     onclick="location.href='{{url_for('voucher_list', record_id = record_to_update.id)}}'">
                <h6 class="" style="margin-left:162px" id="total_vouchers_after">{{total_vouchers}}</h6>

            </div>

            <div class="col-5 text-end " id="cancelled_button_after" style="display:none">
                <button type="button" class="btn btn-danger btn-sm"
                        id="cancelled_button" style="padding:0.3rem 1.5rem"
                        onclick="location.href='{{url_for('set_cancel',record_id = record_to_update.id)}}'">
                    Cancel
                </button>
            </div>

        </div>


    </div>
    <script>
        function client_unchanged(){
    document.getElementById('alert_client').hidden = false;
}

    </script>
    <div class="row w-75 mx-auto">
        <div class="col text-end"
                         style="font-size:small;">
                        Last Updated: {{last_updated}} ({{last_updated_time}})
                    </div>
    </div>
    <div class="w-75 mx-auto row  form-group" style="background-color:#eff4ff; border-radius:20px">
        <div class=" col">
            <div class="row mt-2" id="hide_table">
                <div class="col-6 mb-2" style="font-size:large; font-weight:bold" id="visible_client_name">
                    <u>{{client.client_name}}/{{record_to_update.bill}}</u>
                </div>

                <table class="table">

                    <tbody>
                    <tr>
                        <td class="bold">Client Name:</td>
                        <td>{{client.client_name}}</td>
                    </tr>
                    <tr>
                        <td class="bold">Email:</td>
                        <td>{{client.email}}</td>
                    </tr>
                    <tr>
                        <td class="bold">Phone:</td>
                        <td>{{client.phone_no}}</td>
                    </tr>
                    <tr>
                        <td class="bold">Address:</td>
                        <td>{{client.address}}</td>
                    </tr>
                    <tr>
                        <td class="bold">Final Deal:</td>
                        <td>{{client.final_deal}}</td>
                    </tr>
                    <tr>
                        <td class="bold">GST(18%):</td>
                        <td>{{client.gst}} (Included)</td>
                    </tr>
                    </tbody>

                </table>
            </div>

            <div class="w-100 mx-auto">
                <div class="row">
                    <div class="col mb-2" style="font-size:large; font-weight:bold" id="client_details" hidden>
                        <u>Client Details</u>
                    </div>

                </div>


                <div class="col text-center mb-2 form_editable bg-info text-light client_name"
                     onclick="client_unchanged()" style="font-size:x-large;" hidden>
                    {{record_to_update.client_name.client_name}}
                </div>


                <div class="row display-11 text-danger">
                    <p id="alert_client" hidden>Client Cannot be Changed !</p>
                </div>
                <div class="row display-11">

                    <div class="col form_editable" hidden>
                        <label>Email</label>
                        <input class="form-control" type="text" name="email"
                               value="{{record_to_update.client_name.email}}">
                    </div>
                </div>
                <div class="row display-11">

                    <div class="col form_editable" hidden>
                        <label>Phone</label>
                        <input class="form-control" type="text" name="phone_no"
                               value="{{record_to_update.client_name.phone_no}}">
                    </div>

                </div>

                <div class="col form_editable" hidden>
                    <label>Address</label>
                    <input class="form-control" type="text" name="address"
                           value="{{record_to_update.client_name.address}}">
                </div>


                <div class="row display-11">

                    <div class="col form_editable mb-5" hidden>
                        <label>Final Deal</label>
                        <input class="form-control" type="text" name="final_deal"
                               value="{{record_to_update.client_name.final_deal}}">
                    </div>
                </div>

            </div>
        </div>

        <div class="col-1">

        </div>
        <div class="col" id="hide_table2">
            <div class="row w-100">
                <div class="row">
                    <div class="col mt-2 mb-2" style="font-size:large; font-weight:bold">
                        <u>Bill Details</u>
                    </div>

                </div>
                <table class="table">
                    <tbody>
                    <tr>
                        <td class="bold">AD/GP/Others:</td>
                        <td>{{record_to_update.content_advt}}</td>
                    </tr>
                    <tr>
                        <td class="bold">Release Order Date:</td>
                        <td>{{record_to_update.date_of_order}}</td>
                    </tr>
                    <tr>
                        <td class="bold">Date of Publication:</td>
                        <td>{{record_to_update.dop}}</td>
                    </tr>
                    <tr>
                        <td class="bold">Bill Date:</td>
                        <td>{{record_to_update.bill_date}}</td>
                    </tr>
                    <tr>
                        <td class="bold">Payment Status:</td>
                        <td><p style="border-radius:20px; width: 90px; text-align: center;height: 27px;"
                               class="status display-11" id="status">{{record_to_update.status.value}}</p>
                        </td>
                    </tr>

                    </tbody>

                </table>
            </div>
        </div>
        <div class="row w-50">
            <div class="row" style="font-size:large; font-weight:bold" id="bill_details" hidden>
                <div class="col mb-2">
                    <u>Bill Details</u>
                </div>

            </div>
            <div class="row display-11 mb-1">

                <div class="col form_editable" hidden>
                    <label>AD/GP/Others</label>
                    <textarea style="height:100px" class="form-control" name="content_advt">{{record_to_update.content_advt}}</textarea>
                </div>
            </div>
            <div class="row display-11 mb-1">

                <div class="col form_editable" hidden>
                    <label>Release Order Date</label>
                    <input class="form-control" type="date" name="date_of_order"
                           value="{{record_to_update.date_of_order}}">
                </div>
            </div>
            <div class="row display-11 mb-1">

                <div class="col form_editable" hidden>
                    <label>Date of Publication</label>
                    <input class="form-control" type="date" name="dop" value="{{record_to_update.dop}}">
                </div>
            </div>
            <div class="row display-11 mb-4">

                <div class="col form_editable" hidden>
                    <label>Bill Date</label>
                    <input class="form-control" type="date" name="bill_date" value="{{record_to_update.bill_date}}">
                </div>

            </div>


        </div>

    </div>

    <div class="row ">
        <div class="row">
            <hr class="mx-auto"
                style="border-left: 2px solid lightgrey; background-color:rgba(248,249,250)"/>
        </div>
    </div>

    <div class="row  mb-5">

        {% if record_to_update.filename %}
        <div class="col-7 text-end" style="margin-left:23px; font-size:large; font-weight:bold">
            Attachment:
        </div>
        <div class="col text-start" id="current_file">
            <a class="" style="text-decoration:none; font-size:large"
               href="{{url_for('download',filename = record_to_update.filename, record_id = record_to_update.id)}}">{{client.client_name}}/{{record_to_update.bill}}</a>
        </div>
        <div class="col" id="update_btn_file" hidden>
            <button type="button" class="btn btn-success btn-sm" onclick="new_file_upload()">Update</button>
        </div>
        <div class="col text-start" id="update_file" hidden>
            <label for="file-upload" class="custom-file-upload">
                <i class="fa fa-cloud-upload"></i>Upload Attachment
            </label>
            <input id="file-upload" name='file' type="file" accept="application/pdf" style="display:none;">

        </div>
        {% else %}
        <div class="col-8 text-end" style="margin-left:86px; font-size:large; font-weight:bold">
            Attachment:
        </div>
        <div class="col" style="font-size:large" id="no_attachment">
            No Attachment
        </div>
        <div class="col text-start" id="upload_file" hidden>
            <label for="file1-upload" style="font-weight:600" class="custom-file-upload">
                <i class="fa fa-cloud-upload"></i>Upload Attachment
            </label>
            <input id="file1-upload" name='file' type="file" accept="application/pdf" style="display:none;">

        </div>
        {% endif %}
    </div>
    <div style="display:none">
        {{form.client_name (class="client_name")}}
    </div>
</form>

<script src="{{url_for('static', filename='record_details.js')}}"></script>

{% include 'footer.html' %}
{% endblock %}